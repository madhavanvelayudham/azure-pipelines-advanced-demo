trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - main

variables:
  # default values â€” override in pipeline or variable groups in Azure DevOps
  nodeVersions: '18,20'
  imageName: 'azure-pipelines-demo'
  imageTag: '$(Build.BuildId)'

stages:
  - template: pipelines/templates/ci.yml

  - template: pipelines/templates/package.yml
    parameters:
      dependsOn: 'CI'
      containerRegistry: ${{ variables.containerRegistry }} # set in pipeline variables
      acrServiceConnection: ${{ variables.acrServiceConnection }} # set in pipeline variables
      imageName: ${{ variables.imageName }}
      imageTag: ${{ variables.imageTag }}

  - template: pipelines/templates/deploy.yml
    parameters:
      dependsOn: 'Package'
      azureSubscription: ${{ variables.azureSubscription }} # service connection name
      appName: ${{ variables.appName }} # App Service name
      resourceGroup: ${{ variables.resourceGroup }} # RG name
      environmentName: 'staging'